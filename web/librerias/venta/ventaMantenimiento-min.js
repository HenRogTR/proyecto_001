$(document).ready(function(){$("#bPrimero").click(function(a){fVentaLeer(-1,"primero");$("#numeroOperacion").val("")});$("#bAnterior").click(function(a){var b=parseInt($("#codVenta").val(),10)-1;if(b<1){fAlerta("Este es el primer registro.");b=1}fVentaLeer(b,"anterior")});$("#bSiguiente").click(function(a){fVentaLeer((parseInt($("#codVenta").val(),10)+1),"siguiente")});$("#bUltimo").click(function(a){fVentaLeer(0,"")});$("#bVentaRegistrar").click(function(a){$(location).attr("href","ventaRegistrar.jsp");a.preventDefault()});$("#bVentaBuscar").click(function(a){$("#dVentaBuscar").dialog("open");a.preventDefault()});$("#cronogramaOpcion").click(function(a){fVentaCreditoLetraActual();a.preventDefault()});$("#bEditar").click(function(a){$(location).attr("href","ventaEditar.jsp");a.preventDefault()});$("#bAnular").click(function(a){if($("#codVenta").val()<0||$.trim($("#codVenta").val())==""){$("#lMensajeAlerta").text("*No hay venta seleccionada para anular.");$("#dMensajeAlerta").dialog("open");return}$("#dVentaAnularConfirmar").dialog("open");a.preventDefault()});$("#codVentaBuscar").mask("#",{maxlength:false}).keypress(function(b){var a=b.charCode?b.charCode:b.keyCode?b.keyCode:0;if(a==13){if($.isNumeric(this.value)&this.value>0){$("#docSerieNumeroBuscar").val("");fVentaLeer(this.value,"exacto");this.value=""}b.preventDefault()}})});$(function(){$("#dVentaAnularConfirmar").dialog({autoOpen:false,modal:true,resizable:true,height:200,width:400,buttons:{Confirmar:function(){fVentaAnular();$(this).dialog("close")},Cancelar:function(){$(this).dialog("close")}}});$("#dVentaBuscar").dialog({autoOpen:false,modal:true,resizable:true,height:200,width:440,buttons:{Cerrar:function(){$(this).dialog("close")}},position:{my:"center",at:"right"}});$("#dVentaCreditoLetraOpcion").dialog({autoOpen:false,modal:true,resizable:false,height:600,width:800,buttons:{Modificar:function(){fAlerta("Implementando")},Reprogramar:function(){fAlerta("Implementando")},Imprimir:function(){window.open("reporte/cronogramaImprimir.jsp?codVenta="+$("#codVenta").val(),"_blank");$(this).dialog("close")}}});$("#dLetrasCreditoModificar").dialog({autoOpen:false,modal:true,resizable:true,height:570,width:600,buttons:{"Modificar letras":function(){if(fLetrasCreditoValidar()){}},Aceptar:function(){if($("#auxiliarGenerarLetraCredito").val()=="0"){fAlerta("Genere las letras de credito");return}$(this).dialog("close")}},close:function(){}});$("#docSerieNumeroBuscar").autocomplete({source:"autocompletado/ventasListarDocSerieNumero.jsp",minLength:4,focus:ventaMarcado,select:ventaSeleccionado})});function fPaginaActual(){$("#dProcesandoPeticion").dialog("open");fVentaLeer(parseInt($("#codVenta").val(),10))}function ventaMarcado(b,c){var a=c.item.value;$("#docSerieNumeroBuscar").val(a.docSerieNumero);b.preventDefault()}function ventaSeleccionado(b,c){var a=c.item.value;$("#docSerieNumeroBuscar").val("");$("#codVentaBsucar").val("");fVentaLeer(a.codVenta,"exacto");b.preventDefault()}function fVentaLeer(d,b){var c="codVenta="+d+"&parametro="+b;try{$.ajax({type:"post",url:"ajax/venta.jsp",data:c,error:function(e,g,f){$("#lServidorError").text(f+"(venta.jsp)");$("#dServidorError").dialog("open")},success:function(g,h){var f=procesarRespuesta(g);if(f.length==0){$("#dProcesandoPeticion").dialog("close");fAlerta("Venta no encontradAo")}else{$(".vaciar").empty();var e=f[0];$("#lCodVenta").append(e.codVenta);$("#lRegistroDetalle").append('<a href="../otros/registroDetalle.jsp?registro='+e.registro+'&historial=" target="_blank">Ver detalles</a>');$("#lCliente").append('<a href="../sDatoCliente?accionDatoCliente=mantenimiento&codDatoCliente='+e.codDatoCliente+'">'+e.cliente+"</a>");$("#lDireccion").append(e.direccion);$("#lDniPasaporte").append(e.dniPasaporte);$("#lRuc").append(e.ruc);$("#lDocSerieNumero").append(e.docSerieNumero);$("#codVenta").val(e.codVenta);$("#lTipo").append(e.tipo);$("#lFecha").append(e.fecha);$("#lMoneda").append(e.moneda);$("#lSubTotal").append(e.subTotal);$("#lDescuento").append(e.descuento);$("#lTotal").append(e.total);$("#lMontoIgv").append(e.ValorIgv);$("#lNeto").append(e.neto);$("#lSon").append(e.son);$("#lVendedor").append(e.vendedor);$("#lEmpresaConvenio").append(e.empresaConvenio);$("#lObservacion").append(e.observacion);if(e.registro.substring(0,1)=="1"){$("#ventaAnulada").addClass("ocultar");$("#ventaSinAnular").removeClass("ocultar");if(e.tipo=="CREDITO"){$("#cronograma").removeClass("ocultar")}else{$("#cronograma").addClass("ocultar")}$("#contratoImprimir").attr("href","reporte/contratoCompraVenta.jsp?codVentas="+e.codVenta);$("#clausulaImprimir").attr("href","reporte/clausulaPago.jsp?codVentas="+e.codVenta);$("#bImprimir").attr("target","_blank").attr("href","reporte/ventasImprimir.jsp?codVentas="+e.codVenta)}else{$("#ventaAnulada").removeClass("ocultar");$("#ventaSinAnular").addClass("ocultar");$("#imprimir").removeAttr("href")}fVentaDetalle(e.codVenta)}$("#dProcesandoPeticion").dialog("close")},statusCode:{404:function(){$("#lServidorError").text("P치gina no encontrada(venta.jsp).");$("#dServidorError").dialog("open")}}})}catch(a){$("#lServidorError").text(a);$("#dServidorError").dialog("open")}}function fVentaDetalle(c){var b="codVenta="+c;try{$.ajax({type:"post",url:"ajax/ventaDetalle.jsp",data:b,error:function(d,f,e){$("#lServidorError").text(e+"(ventaDetalle.jsp)");$("#dServidorError").dialog("open")},success:function(f,h){$("#tbVentaDetalle").empty();var e=procesarRespuesta(f);for(var d=0;d<e.length;d++){var g=e[d];$("#tbVentaDetalle").append('<tr><td style="text-align: right;">'+g.item+'</td><td style="text-align: right;">'+g.codArticuloProducto+'</td><td style="text-align: right;">'+g.cantidad+"</td><td>"+g.unidadMedida+"</td><td>"+g.descripcion+g.serie+'</td><td style="text-align: right;">'+g.precioVenta+'</td><td style="text-align: right;">'+g.valorVenta+"</td></tr>")}}})}catch(a){$("#lServidorError").text(a);$("#dServidorError").dialog("open")}}function fVentaAnular(){var a="../sVenta";var c="codVenta="+$("#codVenta").val()+"&accionVenta=anular";try{$.ajax({type:"post",url:a,data:c,error:function(d,f,e){$("#lServidorError").text(e+"(ventaDetalle.jsp)");$("#dServidorError").dialog("open")},success:function(d,e){if(!isNaN(d)){fVentaLeer(d,"exacto")}else{$("#dMensajeAlertaDiv").empty().append(d);$("#dMensajeAlerta").dialog("open")}}})}catch(b){$("#lServidorError").text(b);$("#dServidorError").dialog("open")}}function fVentaCreditoLetraComprobar(){var d=true;var c={codVenta:$("#codVenta").val()};var a="ajax/ventaCreditoLetraComprobar.jsp";try{$.ajax({type:"post",url:a,data:c,beforeSend:function(){fProcesandoPeticion("Comprobando. ")},error:function(e,g,f){$("#lServidorError").text(f+"()");$("#dServidorError").dialog("open")},success:function(e,f){$("#dProcesandoPeticion").dialog("close");if(e==1){fVentaCreditoLetraCargar()}else{fAlerta(e)}},statusCode:{404:function(){$("#lServidorError").text("P치gina no encontrada().");$("#dServidorError").dialog("open")}}})}catch(b){$("#lServidorError").text(b);$("#dServidorError").dialog("open")}return d}function fLetrasCreditoValidar(){var e=true;var b="";var a=$("#numeroLetras");var d=$("#fechaInicio");var c=$("#fechaVencimiento");if(!$.isNumeric(a.val())||a.val()<1){b+="*El numero de letra debe ser mayor a 0.<br>";e=false}if(!d.length||!fValidarFecha(d.val())){b+="*Ingrese fecha inicio<br>";e=false}if(!c.length||!fValidarFecha(c.val())){b+="*Ingrese fecha vencimiento - formato de f. de vencimiento incorrecto.<br>";e=false}if(!e){fAlerta(b)}return e}function fVentaCreditoLetraCargar(){var c={codVenta:$("#codVenta").val()};var a="ajax/ventaCreditoLetraLeer.jsp";try{$.ajax({type:"post",url:a,data:c,beforeSend:function(){},error:function(d,f,e){$("#lServidorError").text(e+"()");$("#dServidorError").dialog("open")},success:function(d,e){$("#tbDetalleLetras").empty().append(d);$("#dVentaCreditoLetraOpcion").dialog("close");$("#dLetrasCreditoModificar").dialog("open")},statusCode:{404:function(){$("#lServidorError").text("P치gina no encontrada().");$("#dServidorError").dialog("open")}}})}catch(b){$("#lServidorError").text(b);$("#dServidorError").dialog("open")}}function fVentaCreditoLetraActual(){var c={codVenta:$("#codVenta").val()};var a="ajax/ventaCreditoLetraActual.jsp";try{$.ajax({type:"post",url:a,data:c,beforeSend:function(){fProcesandoPeticion("Preparando. ")},error:function(d,f,e){$("#lServidorError").text(e+"()");$("#dServidorError").dialog("open")},success:function(d,e){$("#dVentaCreditoLetraActual").empty().append(d);$("#dProcesandoPeticion").dialog("close");$("#dVentaCreditoLetraOpcion").dialog("open")},statusCode:{404:function(){$("#lServidorError").text("P치gina no encontrada().");$("#dServidorError").dialog("open")}}})}catch(b){$("#lServidorError").text(b);$("#dServidorError").dialog("open")}};