$(document).ready(function(){$("#codCompraBuscar").focus();$("#codCompraBuscar").numeric({negative:false,decimal:false});$("#codCompraBuscar").keypress(function(a){if(a.which==13&$(this).val()>0){fCompra($(this).val());$(this).val("")}});$("#compraDocNumeroSerieBuscar").autocomplete({source:"autocompletado/compraDocNumeroSerieBuscarAutocompletado.jsp",minLength:4,select:compraSeleccionado,focus:compraMarcado});if($("#codCompraBuscarAux").val()==0){fCompra(0)}$("#bPrimero").click(function(a){fCompra(-1);a.preventDefault()});$("#bAnterior").click(function(a){fCompra(parseInt($("#codCompra").val(),10)-1);a.preventDefault()});$("#bSiguiente").click(function(a){fCompra((parseInt($("#codCompra").val(),10)+1));a.preventDefault()});$("#bUltimo").click(function(a){fCompra(0);a.preventDefault()})});function compraSeleccionado(b,c){var a=c.item.value;fCompra(a.codCompra);b.preventDefault()}function compraMarcado(b,c){var a=c.item.value;$("#compraDocNumeroSerieBuscar").val(a.docSerieNumero);b.preventDefault()}function fCompra(c){var b="codCompra="+c;try{$.ajax({type:"post",url:"ajax/compra.jsp",data:b,error:callback_error,success:callback_compra})}catch(a){$("#lErrorServidor").text(a);$("#dErrorServidor").dialog("open")}}function callback_compra(b,d){$("#dMensajeAlertaDiv").empty();var c=procesarRespuesta(b);if(c.length==0){$("#dMensajeAlertaDiv").append("Compra no encontrada.<br>");$("#dMensajeAlerta").dialog("open")}else{var a=c[0];$("#codCompra").val(a.codCompra);$("#lCodCompra").text(a.codCompra);$("#lDocSerieNumero").text(a.docSerieNumero);$("#lFechaFactura").text(a.fechaFactura);$("#lTipo").text(a.tipo);$("#lFechaFactura").text(a.fechaFactura);$("#lFechaVencimiento").text(a.fechaVencimiento);$("#lFechaLlegada").text(a.fechaLlegada);$("#lSubTotal").text(a.subTotal);$("#lTotal").text(a.total);$("#lMontoIgv").text(a.montoIgv);$("#lNeto").text(a.neto);$("#lSon").text(a.son);$("#lMoneda").text(a.moneda);$("#lObservacion").text("");$("#lObservacion").append(a.observacion.replace(/\n/gi,"<br>"));$("#lRuc").text(a.ruc);$("#lRazonSocial").text(a.razonSocial);$("#lDireccion").text(a.direccion);$("#compraDocNumeroSerieBuscar").val("");$("#imprimir").attr("href","compraImprimir.jsp?codCompra="+a.codCompra).attr("target","_imprimir");compraDetalleRecuperar(a.codCompra)}}function compraDetalleRecuperar(c){try{var b="codCompra="+c;$.ajax({type:"post",url:"ajax/compraDetalleBuscarAjax.jsp",data:b,error:callback_error,success:compraDetalleRecuperar_callback})}catch(a){alert(a.description)}}function compraDetalleRecuperar_callback(d,f){var b=procesarRespuesta(d);var e=$("#tCompraDetalles");e.find("tr").remove();if(!b){e.append("<tr><td colspan='6'>Â¡No hay ningun articulo para la compra!</td></tr>");return}var c;for(var a in b){c=b[a];e.append("<tr><td style='text-align: right;'><label>"+c.item+"</label></td><td style='text-align: right;'><label>"+c.cantidad+"</label></td><td style='text-align: right;'><label>"+c.unidadMedida+"</label></td><td><label>"+c.descripcion+"</label></td><td style='text-align: right'><label>"+c.precioUnitario+"</label></td><td style='text-align: right'><label>"+c.precioTotal+"</label></td>")}}function procesarRespuesta(ajaxResponse){var response;try{eval("response="+ajaxResponse)}catch(ex){alert("Error proceso respuesta: "+ex);response=null}return response};